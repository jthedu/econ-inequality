---
title: "Inequality PSet 1 - Question #6 (code part)"
author: "JDu"
date: "`r lubridate::today()`"
output: pdf_document
---

## Load necessary libraries
```{r}
library(tidyverse)
library(lubridate)
library(lfe)
library(stats)
library(tsibble)

theme_set(theme_minimal())
```

## could write 6c in .Rmd - but should do 6a & 6b on paper

# Question 6d

## Question 6d(i): Construct the outcome variables

```{r}
q1 <- read_csv("./DataExercise_IV/pset_iv_data.csv") %>%
  rename(pop = Pop, earnPOW = EarnPOW, man = Manufact)

# 6d(i).A: transform var by taking nat logs
q1 <- q1 %>%
  mutate(pay = log(pay),
         pop = log(pop),
         earnPOW = log(earnPOW), # county earnings
         dSSI = log(dSSI)) # SSI payments 
# BE CAREFUL - MAYBE SHOULD KEEP ORIGINAL PAY VAR & NOT OVERWRITE W/ LOG VERSIONS?

# 6d(i).B: construct log diff
q1 <- q1 %>%
  mutate(lagpay = lag(pay, n = 1),
         lagpop = lag(pop, n = 1),
         lagearnPOW = lag(earnPOW, n = 1),
         lagdSSI = lag(dSSI, n = 1)) %>%
  mutate(diff_pay = pay - lagpay,
         diff_pop = pop - lagpop,
         diff_earnPOW = earnPOW - lagearnPOW,
         diff_dSSI = dSSI - lagdSSI)
  #as_tsibble(key = fips, index = year) 
  
  #as.ts(pay, pop, earnPOW, dSSI) %>%
  #mutate(pay_lag1 = lag(pay, +1))

# 6d(i).C: construct var that is fraction of county earnings from manufacturing in 1969
q1 %>%
  filter(year == 1969) %>%
  #pull(man)
  mutate(man_1969 = man/earnPOW)

### ASK ELLIE: fraction of earnings - is it saying "find the fraction of county earnings in every yr compared to the 1969 value of manufacturing)?
# if so, do it like this??
#man_value_1969 <- 
  q1 %>%
  filter(year == 1969) %>%
  pull(man)
```

## Question 6d(ii): Construct the instruments

```{r}
# construct coal price
q1 <- q1 %>%
  mutate(coalprice = pcoalyr/pyr)

# construct change in coal reserves
q1 <- q1 %>%
  mutate(ln_coalprice = log(coalprice),
         lag_coalprice = lag(ln_coalprice, n = 1),
         diff_coalprice = ln_coalprice - lag_coalprice) %>%
  mutate(ln_coalres = log(coalres)) %>%
  mutate(valchange_cr = 
           if_else(coalres > 0,
                   diff_coalprice * ln_coalres, 0)) 
q1 %>%
  filter(coalres > 0)
```


## Question 6d(i): Construct the outcome variables

```{r}
```


## Question 6d(i): Construct the outcome variables

```{r}
```


